@import model.ChannelProfileResult
@(channelProfile: ChannelProfileResult, channelId: String)

@main("Channel Profile") {
    <head>
        <title>Channel Profile</title>
        <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("stylesheets/channel.css")">
    </head>

    <body>
        <section id="channel">
            <div class="wrapper">
                <div id="channelInfo">
                        <!-- Channel Information Section -->
                </div>

                <h3>Channel Videos</h3>
                    <div id="results">
                            <!-- Latest Videos Section -->
                    </div>
            </div>
        </section>

        <script>
                const socket = new WebSocket("ws://localhost:9000/ws");

                socket.onopen = () => {
                    console.log("WebSocket connected for channel profile");
                    socket.send(`channel:${"@channelId"}`);
                };

                socket.onmessage = (event) => {
                    const profile = JSON.parse(event.data);
                    updateChannelProfile(profile);
                };

                socket.onclose = () => console.log("WebSocket closed");
                socket.onerror = (error) => console.error("WebSocket error:", error);


                function updateChannelProfile(profile) {
                    console.log("Channel Profile Updated:", profile);
                    document.getElementById("channelInfo").innerHTML = `
                    <h1>Channel Name: ${profile.channelTitle}</h1>
                    <img src="${profile.channelThumbnailUrl}" alt="Channel Thumbnail" class="channel-thumbnail" />
                    <p><b>Description:</b>${profile.channelDescription}</p>
                    <p><b>Country: </b>${profile.country}<p>
                    <p><b>Subscribers:</b> ${profile.subscriberCount}</p>
                `;

                    const resultsContainer = document.getElementById("results");
                    if (profile.recentVideos && profile.recentVideos.length > 0) {
                        resultsContainer.innerHTML = `
                        <ol>
                            ${profile.recentVideos.map(video => `
                                <li class="result-item">
                                    <div class="result-content">
                                        <div class="text-content">
                                            <p><b>Title:</b> <a href="${video.videoUrl}" target="_blank">${video.title}</a>
                                            <b>Description:</b> ${video.description}
                                            <b>Tags:</b>
                                                ${video.tags.map(tag => `<a href="/taglytics/${tag}" target="_blank">${tag}</a>`).join(", ")}
                                            </p>
                                        </div>
                                        <img src="${video.thumbnailUrl}" alt="Video Thumbnail" class="thumbnail">
                                    </div>
                                </li>
                            `).join("")}
                        </ol>
                    `;
                    } else {
                        resultsContainer.innerHTML = `<p>No recent videos found.</p>`;
                    }
                }
        </script>
    </body>
}
