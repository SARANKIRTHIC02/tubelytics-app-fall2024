@import model.ChannelProfileResult
@(channelProfile: ChannelProfileResult, channelId: String)

@main("Channel Profile") {
    <head>
        <title>Channel Profile</title>
            <!-- Link to CSS -->
        <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("stylesheets/channel.css")">
    </head>

    <body>
        <section id="channel">
            <div class="wrapper">
                    <!-- Header Section -->
                <h1>Channel Profile</h1>

                    <!-- Channel Information Section -->
                <div id="channelInfo">

                </div>

                    <!-- Latest Videos Section -->
                <h3>Channel Videos</h3>
                    <div id="results">

                    </div>
            </div>
        </section>

        <script>
                // WebSocket for dynamic updates
                const socket = new WebSocket("ws://localhost:9000/ws");

                // Event handlers for WebSocket
                socket.onopen = () => {
                    console.log("WebSocket connected for channel profile");
                    // Send a request for channel details
                    socket.send(`channel:${"@channelId"}`);
                };

                socket.onmessage = (event) => {
                    const profile = JSON.parse(event.data);
                    updateChannelProfile(profile);
                };

                socket.onclose = () => console.log("WebSocket closed");
                socket.onerror = (error) => console.error("WebSocket error:", error);

                // Function to update channel information dynamically
                function updateChannelProfile(profile) {
                    console.log("Channel Profile Updated:", profile);

                    // Update channel info
                    document.getElementById("channelInfo").innerHTML = `
                    <h2>${profile.channelTitle}</h2>
                    <p>${profile.channelDescription}</p>
                    <p><b>Subscribers:</b> ${profile.subscriberCount}</p>
                `;

                    // Update recent videos
                    const resultsContainer = document.getElementById("results");
                    if (profile.recentVideos && profile.recentVideos.length > 0) {
                        resultsContainer.innerHTML = `
                        <ol>
                            ${profile.recentVideos.map(video => `
                                <li class="result-item">
                                    <div class="result-content">
                                        <div class="text-content">
                                            <p><b>Title:</b> <a href="${video.videoUrl}" target="_blank">${video.title}</a></p>
                                            <p><b>Description:</b> ${video.description}</p>
                                            <p><b>Tags:</b>
                                                ${video.tags.map(tag => `<a href="/taglytics/${tag}" target="_blank">${tag}</a>`).join(", ")}
                                            </p>
                                        </div>
                                        <img src="${video.thumbnailUrl}" alt="Video Thumbnail" class="thumbnail">
                                    </div>
                                </li>
                            `).join("")}
                        </ol>
                    `;
                    } else {
                        resultsContainer.innerHTML = `<p>No recent videos found.</p>`;
                    }
                }
        </script>
    </body>
}
